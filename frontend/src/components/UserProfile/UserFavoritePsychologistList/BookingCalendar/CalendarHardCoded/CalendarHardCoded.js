import React from 'react'
import './CalendarHardCoded.css'

const CalendarHardCoded = () => {

    let data = [
        {
          date: "Sun Oct 27",
          classes:[
          ]
        },
        {
          date: "Mon Oct 28",
          classes:[
            {
              class: "",
              time: "8:00  - 9:30",
              instructor: "",
              availability: "SIGN UP"
            },
            {
              class: "",
              time: "9:30  - 11:00",
              instructor: "",
              availability: "Full"
            },
            {
              class: "",
              time: "11:00  - 12:30",
              instructor: "",
              availability: "Full"
            },
            {
              class: "",
              time: "13:30  - 15:00",
              instructor: "",
              availability: "Full"
            },
            {
                class: "",
                time: "15:00  - 16:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "16:30  - 18:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "18:00  - 19:30",
                instructor: "",
                availability: "Full"
              },
          ]
        },
        {
          date: "Tue Oct 29",
           classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Wed Oct 30",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Thu Oct 31",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Fri Nov 01",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Sat Nov 02",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        }
      ];
      
      let data2 = [
        {
          date: "Sun Nov 03",
          classes:[
          ]
        },
        {
          date: "Mon Nov 04",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Tue Nov 05",
           classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Wed Nov 06",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Thu Nov 07",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Fri Nov 08",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        },
        {
          date: "Sat Nov 09",
          classes:[
            {
                class: "",
                time: "8:00  - 9:30",
                instructor: "",
                availability: "SIGN UP"
              },
              {
                class: "",
                time: "9:30  - 11:00",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "11:00  - 12:30",
                instructor: "",
                availability: "Full"
              },
              {
                class: "",
                time: "13:30  - 15:00",
                instructor: "",
                availability: "Full"
              },
              {
                  class: "",
                  time: "15:00  - 16:30",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "16:30  - 18:00",
                  instructor: "",
                  availability: "Full"
                },
                {
                  class: "",
                  time: "18:00  - 19:30",
                  instructor: "",
                  availability: "Full"
                },
          ]
        }
      ];
  
  let completeData = [data, data2]
  
  const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  
  class OTFCalendar {
    constructor() {
      this.dateTabs = [];
    }
    
  
    init(data) {
      // setting the dates for the data variables
      let currentDay = new Date();
      let dayIndex = currentDay.getDay();
      let dateArray = currentDay.toString().split(" ");
  
      
      if(dayIndex > 0) {
        var beginningDay = new Date();
        beginningDay.setDate(beginningDay.getDate() - dayIndex);
      } else {
        beginningDay = currentDay;
      }
      
      console.log("biginningDay value: ", beginningDay);
      // populate the dates in the data
      completeData.forEach((data, i) => {
        console.log("this is the value of data: ", i);
        let offset = 0;
        if(i>0){
          offset = 7;
        }
        
        data.forEach( (d, i) => {
          console.log("do we get the offset value: ", offset);
          let day = new Date();
          day.setDate((beginningDay.getDate() + i + offset));
          console.log("what is day value: ", day.toString().slice(0, 10));
          
          d.date = day.toString().slice(0, 10);
        })
      })
      
      console.log("updated data values: ", completeData);
    
      let container = document.querySelector("#main");
      const body = document.querySelector("body");
      const tempFocus = document.createElement("div");
      tempFocus.id = "tempFocus";
      tempFocus.setAttribute('tabindex', '-1');
      tempFocus.style.cssText = 'position:fixed;top:0;left:0;';
      
      // setting up the next and previous buttons
      const prevBtn = document.createElement("button");
      prevBtn.innerHTML = "<";
      prevBtn.setAttribute("aria-label","previous week's schedule");
      prevBtn.setAttribute("class","previous-btn");
      prevBtn.disabled = true;
      const nextBtn = document.createElement("button");
      nextBtn.innerHTML = ">";
      nextBtn.setAttribute("aria-label","next week's schedule");
      nextBtn.setAttribute("class","next-btn");
  
      // set up for the tab section of the calendar
      const calendarContainer = document.createElement("div");
      let calendarDatesContainer = document.createElement("ul");
      calendarContainer.setAttribute("class", "calendar-container");
      calendarDatesContainer.setAttribute("class", "dates-container")
      calendarDatesContainer.setAttribute("role", 'tablist');
      calendarContainer.appendChild(prevBtn);
      calendarContainer.appendChild(calendarDatesContainer);
      calendarContainer.appendChild(nextBtn);
      
      prevBtn.addEventListener("click",   this.getPreviousSchedule.bind(this));
      nextBtn.addEventListener("click", this.getNextSchedule.bind(this))
      
      // set up for the schedule of the calendar
      const scheduleContainer = document.createElement("div");
      scheduleContainer.setAttribute("class", "schedule-container");
      
      const activeTabArray = this.getActiveTabArray(data);   
      const scheduleDataIndex = activeTabArray.indexOf(false);
      for( var i = 0; i<7; i++) {
        const tab = this.createTabNavigation(data[i], i, scheduleDataIndex, activeTabArray);
        calendarDatesContainer.appendChild(tab);  
      }
      
      body.appendChild(tempFocus);
      container.appendChild(calendarContainer);
      container.appendChild(scheduleContainer);
      this.setActiveTab(scheduleDataIndex);
      
      this.refreshSchedule(data[scheduleDataIndex].classes);
    }
    
    createTabNavigation(data, counter, index, activeTabArray) {
          const tab = this.populateTabs(data.date, counter);
  
      tab.childNodes[0].addEventListener("click", this.tabBtnClicked.bind(this, {"classes": data.classes, "index": counter}));
  
      if(activeTabArray[counter]) {
        tab.childNodes[0].disabled = true;
      } else {
        tab.childNodes[0].disabled = false;
      }
  
      return tab;
    }
    
    getActiveTabArray(data) {
      console.log("what is data: ", data);
      const todayDateArray = new Date().toString().split(' ');
      const dayOfMonth = new Date().getDate();    
      const activeTabArray = data.map((d) => {
        const dateArray = d.date.split(" ");
        
        // call the new getIndexOfMonth here!!!
        const month1 = this.getIndexOfMonth(dateArray[1]);
        console.log("what is  month1: ", month1);
        const validationMonth = this.getIndexOfMonth(todayDateArray[1]);
        console.log("what is the validationMonth: ", validationMonth);
        // end of new call to added function
        
        // change logic for comparing current dates from simple return line to 
        if(month1 < validationMonth) {
          return true;
        } else if (month1 > validationMonth){
          return false;
        } else {
          console.log("trying to get Nov tabs to be active");
          if(dateArray[2] < dayOfMonth) {
            console.log("checking day and month values");
            return true;
          } else {
            return false;
          }
        }
        // end of new date comparison for active tab
        
      });
      console.log("what is the active tab array: ", activeTabArray);
  
      return activeTabArray;
    }
    
    
    /**
     * just added this function so we can compair the months based on index rather than strings
     */
    getIndexOfMonth(m) {
          const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
      const month = months.findIndex((month) => {
        return month.includes(m);
      });
      console.log("what is m: ", m);
      return month;
    }
    /**
     * end of new function!!!!
     */
    
    
    populateTabs(date, index) {
      date = date.split(" ");
      
      // also call the new getIndexOfMonth here
      const month = this.getIndexOfMonth(date[1]);
      // end of new functioon call
      
      let listElement = document.createElement("li");
      let btn = document.createElement("button");
      
      const fullToday = new Date();
      const todayDateArray = fullToday.toString().split(' ');
      const dayOfMonth = fullToday.getDate();
      
      listElement.setAttribute("role", "presentation");
      btn.setAttribute("role", "tab");
      btn.setAttribute("aria-selected", "false");
      btn.className = "tab-btn";
      
      let daySpan = document.createElement("span");
      
      if(date[1] == todayDateArray[1] && date[2] == dayOfMonth) {
        daySpan.innerHTML= "Today";
      } else {
        daySpan.innerHTML= date[0];
      }
      
      btn.setAttribute("aria-label", days[index] + " " + date[1] + " " + date[2]);
      
      btn.appendChild(daySpan);
      btn.innerHTML += month + "/" + date[2];
      
      listElement.appendChild(btn);
      
      return listElement;
    }
    
    populateSchedule(classes) {
      let scheduleColumn = document.createElement("ul");
      scheduleColumn.setAttribute("class", "fitness-classes");
   
      classes.forEach( classDetail => {
        // order for desktop: time, class over instructor, button
        const classContainer = document.createElement("li");
        classContainer.setAttribute("class", "class-details");
        
        const classContent = document.createElement("div");
        classContent.setAttribute("class", "class-content");
        
        const timeContainer = document.createElement("span");
        timeContainer.setAttribute("class", "class-time");
        timeContainer.innerHTML = classDetail.time.toLowerCase().replace(" ", '');
        
        const classSpecsContainer = document.createElement("div");
        classSpecsContainer.setAttribute("class", "class-specs");
        
        const classNameContainer = document.createElement("span");
        classNameContainer.setAttribute("class", "class-name");
        classNameContainer.innerHTML = classDetail.class;
  
        const instructorContainer = document.createElement("span");
        instructorContainer.setAttribute("class", "instructor-name");
        instructorContainer.innerHTML = classDetail.instructor;
        
        classSpecsContainer.appendChild(classNameContainer);
        classSpecsContainer.appendChild(instructorContainer);
   
        const classCTA = document.createElement("button");
        switch(classDetail.availability.toLowerCase() ) {
          case "waitlist":
            classCTA.setAttribute("class", "wait-list");
            classCTA.setAttribute("aria-label", "Join the Waitlist for " + classDetail.class + " with " + classDetail.instructor + " at " + classDetail.time);
            classCTA.innerHTML = "WAITLIST";
            break;
          case "sign up":
            classCTA.setAttribute("class", "sign-up");
            classCTA.setAttribute("aria-label", "Book " + classDetail.class + " with " + classDetail.instructor + " at " + classDetail.time);
            classCTA.innerHTML = "AVAILABLE";
            break;
          case "full":
            classCTA.setAttribute("class", "class-full");
            classCTA.setAttribute("aria-label", classDetail.class + " with " + classDetail.instructor + " at " + classDetail.time + " is full");
            classCTA.innerHTML = "NOT AVAILABLE";
            break;
          default:
            break;
        }
        
        classContent.appendChild(timeContainer);
        classContent.appendChild(classSpecsContainer);
        classContainer.appendChild(classContent); 
        classContainer.appendChild(classCTA);     
        
        scheduleColumn.appendChild(classContainer);
        
      })
      
      return scheduleColumn; 
    }
    
    refreshSchedule(data) {     
      let container = document.getElementsByClassName("schedule-container");
      container[0].innerHTML = "";
      const schedule = this.populateSchedule(data);
      container[0].appendChild(schedule);
    }
    
    refreshTabs(data){
      let container = document.getElementsByClassName("dates-container");
      container[0].innerHTML = "";
      
      const activeTabArray = this.getActiveTabArray(data);    
      const scheduleDataIndex = activeTabArray.indexOf(false);
      
      for( var i = 0; i<7; i++) {      
        const tab = this.createTabNavigation(data[i], i, scheduleDataIndex, activeTabArray);
        container[0].appendChild(tab);
      }
      
      const noPrevFlag = activeTabArray.every( ( d ) => {
        return d == false;
      });
      
      if(!noPrevFlag) {
        const tempBtn = document.getElementsByClassName("previous-btn")[0];
        tempBtn.disabled = true;
      }
      
      this.setActiveTab(scheduleDataIndex);
  
      this.refreshSchedule(data[scheduleDataIndex].classes);
    }
    
    tabBtnClicked(data) {
      this.setActiveTab(data.index)
      this.refreshSchedule(data.classes)
    }
    
    getPreviousSchedule() {
      this.refreshTabs(data);
    }
    
    getNextSchedule() {
      let prevBtn = document.getElementsByClassName("previous-btn");
      prevBtn[0].disabled = false;
      this.refreshTabs(data2);
    }
    
    setActiveTab(index) {
      let hiddenBtn = document.createElement("button");
      hiddenBtn.setAttribute("class", "screen_reader_only");
      hiddenBtn.setAttribute("aria-label", "go to the schedule");
      hiddenBtn.innerHTML = "schedule";
      hiddenBtn.addEventListener("click",this.setFocusToSchedule.bind(this))
      
      const tempElm = document.querySelector("#tempFocus");
      tempElm.focus();
      let tabs = Array.from(document.getElementsByClassName("tab-btn"));
      tabs.forEach( (tab) => {
        if( tab.parentNode.className.includes("active") ) {
          tab.parentNode.className = "";
          tab.className = "tab-btn";
          tab.setAttribute("aria-selected", "false");
          let removeBtn = tab.parentNode.getElementsByClassName("screen_reader_only");
          tab.parentNode.removeChild(removeBtn[0]);
        }
      });
      const parent = tabs[index].parentNode;
      parent.appendChild(hiddenBtn);
      
      tabs[index].parentNode.setAttribute("class", "active");
      
      tabs[index].setAttribute("aria-selected", "true");
      
      setTimeout(() => {
        tabs[index].focus();
      }, 50);
      
    }
    
    setFocusToSchedule() {
      const scheduleClasses = document.getElementsByClassName("class-details");
      const focusedBtn = scheduleClasses[0].getElementsByTagName("button");
      focusedBtn[0].focus();
    } 
  }
  let calendar = new OTFCalendar();
  calendar.init(data); 
  

    return(
       <div></div>
    )
}

export default CalendarHardCoded